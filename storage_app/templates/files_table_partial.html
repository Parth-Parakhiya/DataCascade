<div class="table-responsive">
    <table class="files-table">
        <thead>
            <tr>
                <th>File Name</th>
                <th>Size</th>
                <th>Uploaded On</th>
                <th>Last Downloaded</th>
                <th>Actions</th>
                <th>Status</th>
            </tr>
        </thead>
        <tbody>
            {% for file in page_obj %}
            <tr>
                <td class="file-name">
                    {% if file.file_name|lower|slice:"-4:" == ".pdf" %}
                        <i class="fas fa-file-pdf file-icon" style="color: #e74c3c;"></i>
                    {% elif file.file_name|lower|slice:"-4:" == ".zip" %}
                        <i class="fas fa-file-archive file-icon" style="color: #f39c12;"></i>
                    {% elif file.file_name|lower|slice:"-5:" == ".docx" %}
                        <i class="fas fa-file-word file-icon" style="color: #2980b9;"></i>
                    {% elif file.file_name|lower|slice:"-4:" == ".doc" %}
                        <i class="fas fa-file-word file-icon" style="color: #2980b9;"></i>
                    {% elif file.file_name|lower|slice:"-4:" in ".png.jpg.jpeg" %}
                        <i class="fas fa-file-image file-icon" style="color: #27ae60;"></i>
                    {% elif file.file_name|lower|slice:"-4:" == ".txt" %}
                        <i class="fas fa-file-alt file-icon" style="color: #3498db;"></i>
                    {% elif file.file_name|lower|slice:"-4:" == ".csv" %}
                        <i class="fas fa-file-csv file-icon" style="color: #e67e22;"></i>
                    {% elif file.file_name|lower|slice:"-5:" == ".xlsx" %}
                        <i class="fas fa-file-excel file-icon" style="color: #2ecc71;"></i>
                    {% elif file.file_name|lower|slice:"-4:" == ".xls" %}
                        <i class="fas fa-file-excel file-icon" style="color: #2ecc71;"></i>
                    {% elif file.file_name|lower|slice:"-4:" == ".mp3" %}
                        <i class="fas fa-file-audio file-icon" style="color: #9b59b6;"></i>
                    {% elif file.file_name|lower|slice:"-4:" == ".mp4" %}
                        <i class="fas fa-file-video file-icon" style="color: #34495e;"></i>
                    {% else %}
                        <i class="fas fa-file-alt file-icon" style="color: #7f8c8d;"></i>
                    {% endif %}
                    {{ file.file_name }}
                </td>
                <td class="file-size">
                    {% if file.file_size < 1024 %}
                        {{ file.file_size }} bytes
                    {% elif file.file_size < 1048576 %}
                        {% widthratio file.file_size 1024 1 %} KB
                    {% elif file.file_size < 1073741824 %}
                        {% widthratio file.file_size 1048576 1 %} MB
                    {% elif file.file_size < 1099511627776 %}
                        {% widthratio file.file_size 1073741824 1 %} GB
                    {% else %}
                        {% widthratio file.file_size 1099511627776 1 %} TB
                    {% endif %}
                </td>
                <td>{{ file.uploaded_at|date:"F j, Y, g:i a" }}</td>
                <td>
                    {% if file.last_downloaded_at %}
                    {{ file.last_downloaded_at|date:"F j, Y, g:i a" }}
                    {% else %}
                    <span class="never-downloaded">Never</span>
                    {% endif %}
                </td>
                <td>
                    <div class="file-actions">
                        <a href="{% url 'download_file' file_id=file.file_id %}"
                            class="btn btn-primary download-btn button-main" 
                            data-file-id="{{ file.file_id }}" 
                            data-file-name="{{ file.file_name }}" 
                            download>
                            <i class="fas fa-download"></i> Download
                        </a>
                        <a href="{% url 'delete_file' file_id=file.file_id %}"
                            class="btn btn-danger delete-btn" 
                            data-file-id="{{ file.file_id }}" 
                            data-file-name="{{ file.file_name }}">
                            <i class="fas fa-trash"></i> Delete
                        </a>
                    </div>
                </td>
                <td>
                    <div id="download-status-{{ file.file_id }}" class="download-status"></div>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <div class="pagination">
        <ul class="step-links">
            {% if page_obj.has_previous %}
                <li><a href="{% url 'ajax_files' %}?page=1">&laquo;</a></li>
                <li><a href="{% url 'ajax_files' %}?page={{ page_obj.previous_page_number }}">&lsaquo;</a></li>
            {% endif %}

            {% for num in page_obj.paginator.page_range %}
                {% if page_obj.number == num %}
                    <li class="active"><span>{{ num }}</span></li>
                {% else %}
                    <li><a href="{% url 'ajax_files' %}?page={{ num }}">{{ num }}</a></li>
                {% endif %}
            {% endfor %}

            {% if page_obj.has_next %}
                <li><a href="{% url 'ajax_files' %}?page={{ page_obj.next_page_number }}">&rsaquo;</a></li>
                <li><a href="{% url 'ajax_files' %}?page={{ page_obj.paginator.num_pages }}">&raquo;</a></li>
            {% endif %}
        </ul>
    </div>
</div>